{% load staticfiles %}
<!DOCTYPE html>

<html>
        <head>
        <meta name = "viewport" content = "initial-scale = .25, minimum-scale = .25, maximum-scale= .25, width = device-width,  user-scalable=no">
                <LINK href="{% static 'player/css/style.css' %}" rel="stylesheet" type="text/css">
                <link href="http://fonts.googleapis.com/css?family=Oleo+Script" rel="stylesheet" type="text/css">
                <link href="http://fonts.googleapis.com/css?family=Merienda+One" rel="stylesheet" type="text/css">
                <link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">

                <!-- <LINK href="css/style.css" rel="stylesheet" type="text/css"> -->
        </head>
        <body>
        <div id="player">

            <canvas id="scroll" class="canvasld"></canvas>

            <div id="timer">
                <canvas id="display" width="15vw" height="25vw"></canvas>
            </div>            

            <div id="album">
                <img src="https://api.deezer.com/album/302127/image?size=big">
            </div>

        </div>

        <div id="blackboard" >

            <div id="playlist" class="sort" data-sort="myorder:desc">

                 <div id="label" class="mix" data-myorder="1">
                    <div id="rank">1</div>
                    <div id="title">Titre de la chanson</div>
                    <div id="artist">Artist</div>
                </div>
 <!--               
                <div id="label" class="mix" data-myorder="2">
                    <div id="rank">2</div>
                    <div id="title">Titre de la chanson</div>
                    <div id="artist">Artist</div>
                </div>
                <div id="label" class="mix" data-myorder="3">
                    <div id="rank">3</div>
                    <div id="title">Titre de la chanson</div>
                    <div id="artist">Artist</div>
                </div>
                <div id="label" class="mix" data-myorder="4">
                    <div id="rank">4</div>
                    <div id="title">Titre de la chanson</div>
                    <div id="artist">Artist</div>
                </div>
                <div id="label" class="mix" data-myorder="5">
                    <div id="rank">5</div>
                    <div id="title">Titre de la chanson</div>
                    <div id="artist">Artist</div>
                </div>
                <div id="label" class="mix" data-myorder="6">
                    <div id="rank">6</div>
                    <div id="title">Titre de la chanson</div>
                    <div id="artist">Artist</div>
                </div>
                <div id="label" class="mix" data-myorder="7">
                    <div id="rank">7</div>
                    <div id="title">Titre de la chanson</div>
                    <div id="artist">Artist</div>
                </div> -->
                
            </div>
    <p id="inner"></p>
    <p id="play"></p>
    <table id="DataTable" border="1">
    </table>
        </div>
        </body>

        <footer>
                <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
                <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
                <script type="text/javascript" src="{% static 'player/js/design.js' %}"></script>
                <script type="text/javascript" src="{% static 'player/js/segment-display.js' %}"></script>
                <script type="text/javascript" src="{% static 'player/js/excanvas.js' %}"></script>
                <script src="http://cdn.jsdelivr.net/jquery.mixitup/latest/jquery.mixitup.min.js"></script>



<script type="text/javascript">

      var display = new SegmentDisplay("display");
      display.pattern         = "##:##";
      display.cornerType      = 1;
      display.displayType     = 16;
      display.displayAngle    = 13;
      display.digitHeight     = 20;
      display.digitWidth      = 12;
      display.digitDistance   = 1;
      display.segmentWidth    = 2;
      display.segmentDistance = 0.3;
      display.colorOn         = "rgba(36, 221, 34, 1)";
      display.colorOff        = "rgba(27, 65, 5, 0.5)";

      animate();

      function animate() {
        var time    = new Date();
        var hours   = time.getHours();
        var minutes = time.getMinutes();
        var seconds = time.getSeconds();
        var value   = ((minutes < 10) ? '0' : '') + minutes
                    + ':' + ((seconds < 10) ? '0' : '') + seconds;
        display.setValue(value);
        window.setTimeout('animate()', 100);
      }

    </script>

    <script src="{% static 'player/js/main.js' %}"></script>   

<script src="http://localhost:8888/socket.io/socket.io.js"></script>
<script>
    socket = io.connect('http://localhost:8888/player');
    socket.on('connected', function (data) {
        alert(data);
    });

    var playlistJson;
    // var url = "http://0.0.0.0:8000/manager/getSession/"
    // var resquest = require("request")
    
    socket.on('playlistOn', function (data) {
        $( "#inner" ).empty();
        $( "#DataTable" ).empty();

        // request({
        //     url: url,
        //     json: true
        // }, function (error, response, body) {

        //     if (!error && response.statusCode === 200) {
        //         console.log(body) // Print the json response
        //         console.log('Manager says : ' + body.playlist.title)
        //         playlistJson = body
        //     }
        // })

        data;
        // playlistJson = $.parseJSON(data);
        // $( "#inner" ).prepend(playlistJson.title );
        $( "#playlist" ).empty();
        for(var i = 0, l = 7; i < l; i++) {
        $("#playlist").append($("<div data-myorder=" + data.tracks[i].vote +">").prop("id","label").prop( "class", "mix")

            .append($("<div>").prop("id","rank")
            .append(  data.tracks[i].vote ))

            .append($("<div>").prop("id","title")
            .append(  data.tracks[i].title.substring(0,25) ))

            .append($("<div>").prop("id","artist")
            .append(  data.tracks[i].Artist.name ))
            );


        }

        $('#playlist').mixItUp('sort', 'myorder:desc');
        // $('#playlist').mixItUp('sort', 'random', true);



        // for(var i = 0, l = playlistJson.Tracks.length; i < l; i++) {
        // for(var i = 0, l = 7; i < l; i++) {
        //   $( "#DataTable" ).append( '<tr><td>' + playlistJson.Tracks[i].title + '</td><td id="'+i+'"></td></tr>' );
        // }
    });

    socket.on('playlistOff', function (data) {
        $( "#inner" ).empty();
        $( "#inner" ).prepend(data);
        $( "#DataTable" ).empty();
        $( "#play" ).empty();
        $( "#scroll" ).empty();
        $( "#scroll").prepend(data);
        $('.canvasld, .crl').leddisplay("destroy");
        var options = {
            pixelSize: 10, 
            stepDelay: 100, 
            horizontalPixelsCount:15,
            verticalPixelsCount:5,
            pixelRatio: 0.8
        };
        $('.canvasld, .crl').leddisplay($.extend(options, {pixelSize: 5}));
    });

    socket.on('current_track', function (data) {
        $.getJSON("{% url 'manager:next' %}", function(json){
        nextTrack(json); //2000 is equivalent to 2 seconds
        });
    });


    socket.on('votes', function (data, message) {
      // alert(data);
        // var table = document.getElementById('DataTable')
        // for(var i = 0, l = data.length; i < l; i++) {
        //   table.rows[i].cells[1].innerHTML = data[i];
        // }
        $( "#playlist" ).empty();
        for(var i = 0, l = 7; i < l; i++) {
        $("#playlist").append($("<div data-myorder=" + data.tracks[i].vote +">").prop("id","label").prop( "class", "mix")

            .append($("<div>").prop("id","rank")
            .append(  data.tracks[i].vote ))

            .append($("<div>").prop("id","title")
            .append(  data.tracks[i].title.substring(0,25) ))

            .append($("<div>").prop("id","artist")
            .append(  data.tracks[i].Artist.name ))
            );
        }
        // Â²t("voting");
        $('#playlist').mixItUp('sort', 'myorder:desc', true);
        $.getJSON("{% url 'manager:vote' %}", { vote_id : message}, function(json){
        });
    });

</script> 
<script type="text/javascript" src="{% static 'player/js/jquery.leddisplay.js' %}"></script>

<script type="text/javascript">
      $( "#scroll" ).empty();
      $( "#scroll").prepend("NO Tracks");
      var options = {
            pixelSize: 10, 
            stepDelay: 100, 
            horizontalPixelsCount:15,
            verticalPixelsCount:5,
            pixelRatio: 0.8
        };
        $('.canvasld, .crl').leddisplay($.extend(options, {pixelSize: 5}));
</script>

<script>
    function redirect(){
       window.location.href = "http://localhost:8888/manager/next/";
    }

function nextTrack (data) {

    $( "#play" ).empty();
    $( "#play" ).append('<iframe height="0" width="0" scrolling="no" frameborder="0" allowTransparency="true" src="http://www.deezer.com/plugins/player?autoplay=true&playlist=false&width=700&height=80&cover=true&type=tracks&id='+data.current_track.DeezerId+'&title=&app_id=undefined" width="700" height="80"></iframe>');
    $( "#scroll" ).empty();
    var plop = data.current_track.Artist.name +" - "+data.current_track.title.substring(0,10) ;
    $( "#scroll" ).empty();
    $( "#scroll").prepend(plop);
    $('.canvasld, .crl').leddisplay("destroy");
    var options = {
        pixelSize: 10, 
        stepDelay: 100, 
        horizontalPixelsCount:15,
        verticalPixelsCount:5,
        pixelRatio: 0.8
    };
    $('.canvasld, .crl').leddisplay($.extend(options, {pixelSize: 5}));

    // setTimeout(getSession, data.current_track.msec)
    setTimeout(getSession, 20000)
}

function getSession (argument) {
    $.getJSON("{% url 'manager:next' %}", function(json){
        nextTrack(json); //2000 is equivalent to 2 seconds
        });}
</script>


        </footer>